<!DOCTYPE html>
<meta charset="utf-8">
<body>
  <style>
  /* Düğümler için stil */
/* Hover effect for nodes */
:root {
  --node-stroke-color: #382288;
  --link-stroke-color: #000;
  --tooltip-background: rgba(0, 0, 0, 0.75);
  --tooltip-color: #fff;
}

.node:hover {
  cursor: pointer;
}

.node circle {
  stroke: var(--node-stroke-color);
  stroke-width: 0.75px;
}

.node text {
  pointer-events: none;
  font-size: 0.75rem; /* Adjusted from 11px to rem */
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.link {
  stroke: var(--link-stroke-color);
  stroke-width: 1px;
  stroke-opacity: 0.5;
}

/* Tooltip styles */
.d3-tip {
  font-size: 0.75rem; /* Adjusted from 11px to rem */
  line-height: 1.4;
  padding: 0.75rem;
  background: var(--tooltip-background);
  color: var(--tooltip-color);
  border-radius: 0.2rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.d3-tip:after {
  content: "\25BC";
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  color: var(--tooltip-background);
}

.d3-tip.n:after {
  margin-top: -1px;
}


  </style> 
    <link rel="stylesheet" type="text/css" href="static/lib/style.css">
    <script src="static/lib/d3.min.js"></script>
    <script src="static/lib/d3-tip.js"></script>

  
  <div class="card text-white border-0">

    <div class="card-img-overlay --card-img-overlay-purple d-flex flex-column justify-content-between align-items-start p-5 four"></div>

    <div class="card-img-overlay card-overlay-black hover-light d-flex flex-column justify-content-between align-items-start">
      <div class="d-flex justify-content-between w-100 mb-3">
        <div><span class="badge badge-warning3 mr-2"> Emre Dinç   </span> & <span class="badge badge-info"> Batuhan Eymen Çorlu</span></div>

        <a href="javascript://">
          <div class="myicoo"></div>
        </a>
      </div>
      <div class="mb-4">

        <div class="h3"><a class="text-white text-decoration-none" href="javascript://">Facebook Social Network Graph<br>Project</a></div>
      </div>
      <div id="currentDate" class="text-light"></div>

      
      
    </div>
  </div>
   <div class="form-container">
            <h2>Yeni Kullanıcı ve Arkadaşları</h2>
            <form method="POST" action="/" >                
                <label for="friend1">Arkadaş 1 ID:</label>
                <input type="text" id="friend1" name="friend1"><br><br>
                <label for="friend2">Arkadaş 2 ID:</label>
                <input type="text" id="friend2" name="friend2"><br><br>
                <input type="submit" value="Gönder">
            </form>
            {% if common_friends %}
            <div class="result-container">
                <h2>Ortak Arkadaşlar</h2>
                <p><strong>Ortak Arkadaşlar:</strong></p>
                <ul>
                    {% for friend in common_friends %}
                        <li>{{ friend }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
  </div>
  <p id="info">Emre Dinç - Batuhan Eymen Çorlu 205542011 - 205541043  graphi büyütmek ve küçültmek için <b>scroll</b> kullanin 
    <a href="https://github.com/emreDinc23">@emreDinc23</a>
    Web sitemizi ziyaret edebilirsiniz <a href="http://dincemre.com.tr">dincemre</a>. <a class="btnnext"href="{{ url_for('previous') }}">Next</a></p>
 
  <script>
    var width = 1920,  //960x720, 640x480, or 528x528
        height = 800;


    var dataset = [];
    var links = [];
    var linkedByIndex = {};
    d3.csv("static/lib/data/MyFBFriendsDataSet.csv", function(d) {        
        var friendList = d.friendList.split("/");
        var sourceIndex = +d.id - 1;
        linkedByIndex[sourceIndex + "," + sourceIndex] = 1; //-- linked to itself
        if (+d.numMutualFriends > 0) {
          friendList.forEach(function(d, i){ 
            var targetIndex = friendList[i] - 1;
            links.push({"source": sourceIndex, "target": targetIndex});
            linkedByIndex[sourceIndex + "," + targetIndex] = 1;
          }); //forEach
        }
        return {
          firstName: d.firstName.split("/")[0],
          lastName: d.lastName,
          name: d.firstName.split("/")[0] + " " + d.lastName,
          sex: d.sex,
          numFriends: +d.numFriends,
          numMutual: +d.numMutualFriends,
          friendList: friendList,
          id: d.id
        };
      }, function(error, rows) {
        dataset = rows;
        createNodeWithDataSet();
    });

    function createNodeWithDataSet() {
      var toggle = 0;
      var selectedNode;
      var nodes = dataset,
      // root = nodes[0],
      // root.fixed = true,
      rScale = d3.scale.linear().clamp(true)
                        .domain([10, 500])
                        .range([10, 30]);

      var force = d3.layout.force()
          .gravity(.15)
          .charge(-75)
          .size([width, height])
          .nodes(nodes);

      force.start();

      //-- create svg element
      var svg = d3.select("body").append("svg")
          .attr("width", width)
          .attr("height", height);

      //-- Initialize tooltip
      var tip = d3.tip()
          .attr('class', 'd3-tip')
          .offset([-10, 0])
          .html(function(d) { 
            return d.name + ", " + " ortak arkadaş sayısı</span>"+": "+ d.numMutual  + "</span>" +", " + " arkadaş sayısı: " + d.numFriends; 
          });

          svg.call(tip)

      //-- create nodeGroup w. circle & text
      var nodeGroup = svg.selectAll(".node")
          .data(nodes)
          .enter()
          .append("g")
          .attr("class", "node")
          .on('mouseover', tip.show)
          .on("mouseover", function(d) {
            if (this != selectedNode && toggle == 0) {
              d3.select(this).selectAll('circle').style("fill", "#ffcc00");
              d3.select(this).selectAll('text.num')
                .style("fill", "black")
                .text(function(d) {
                  return d.numFriends;
                });
              tip.show(d);
            }
            if (this == selectedNode) tip.show(d);
          })
          .on('mouseout', function(d) {
            if (this != selectedNode && toggle == 0) {
              d3.select(this).selectAll('circle').style("fill", function(d, i) { 
                return (d.sex == "f") ? "white":"black"; });
              d3.select(this).selectAll('text.num')
                .style("fill", function(d, i) { 
                  return (d.sex == "f") ? "black":"white"; })
                .text(function(d) {
                  var num = d.numFriends;
                  if (d.numFriends > 500) {
                    if (d.numFriends > 2000) {
                      num = "2000+";
                    } else if (d.numFriends > 1000) {
                      num = "1000+";
                    } else {
                      num = "500+";
                    }
                  }
                  return num;
                })
              tip.hide(d);
            } 
            if (this == selectedNode) tip.hide(d);
          })
          .on("click", onNodeClick)
          .call(force.drag);

      //-- circle
      nodeGroup.append("circle")
          .attr("r", function(d) {
            d.radius = rScale(d.numFriends);
            if (d.numFriends > 1000) {
              d.radius = (d.numFriends > 2000)? 50:40;
            }
            return (d.radius);
          })
          .style("fill", function(d, i) { 
            return (d.sex == "f") ? "white":"black"; 
          });
          
      //-- text
      nodeGroup.append("text")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("class", "num")
            .attr("fill", function(d, i) { return (d.sex == "f") ? "black":"white"; })
            .text(function(d) {
              var num = d.numFriends;
              if (d.numFriends > 500) {
                if (d.numFriends > 2000) {
                  num = "2000+";
                } else if (d.numFriends > 1000) {
                  num = "1000+";
                } else {
                  num = "500+";
                };
              }
              return num;
            });

      nodeGroup.append("text")
            .attr("text-anchor", "middle")
            .attr("dy", function(d) { return (d.radius + 11); })
            .attr("class", "label")
            .attr("fill", "black")
            .attr("visibility", "hidden")
            .text(function(d) {
              return d.name;
            });

      function onNodeClick() {
        if (toggle == 0) {
          //-- Reduce the opacity of all but the neighbouring nodes
          d = d3.select(this).node().__data__;  //**********//
          nodeGroup.style("opacity", function (o) {
            return neighboring(d, o) | neighboring(o, d) ? 1 : 0.1;
          });
          toggle = 1;
          selectedNode = this;
          nodeGroup.selectAll("text.label").style("visibility", function (o) {
            return neighboring(d, o) | neighboring(o, d) ? "visible" : "hidden";
          });

        } else {
          if (this == selectedNode) {
            //-- Put them back to opacity=1
            nodeGroup.style("opacity", 1);
            toggle = 0;
            //--------------------//
            d3.select(selectedNode).selectAll('circle').style("fill", function(d, i) { 
              return (d.sex == "f") ? "white":"black"; });
            d3.select(selectedNode).selectAll('text.num')
              .style("fill", function(d, i) { 
                return (d.sex == "f") ? "black":"white"; })
              .text(function(d) {
                var num = d.numFriends;
                if (d.numFriends > 500) {
                  if (d.numFriends > 2000) {
                    num = "2000+";
                  } else if (d.numFriends > 1000) {
                    num = "1000+";
                  } else {
                    num = "500+";
                  }
                }
                return num;
              })
            nodeGroup.selectAll("text.label").style("visibility","hidden")
            tip.hide(d);
            //--------------------//
            selectedNode = null;
          }
        } //else
      }//-- nodeClick

      force.on("tick", function() {
        var q = d3.geom.quadtree(nodes),
            i = 0,
            n = nodes.length;

        while (++i < n) q.visit(collide(nodes[i]));

        nodeGroup.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
      });
    }

    // ------ function collide ---------- //
    function collide(node) {
      // var r = node.radius + 16,
      var r = node.radius + 45,
          nx1 = node.x - r,
          nx2 = node.x + r,
          ny1 = node.y - r,
          ny2 = node.y + r;
      return function(quad, x1, y1, x2, y2) {
        if (quad.point && (quad.point !== node)) {
          var x = node.x - quad.point.x,
              y = node.y - quad.point.y,
              l = Math.sqrt(x * x + y * y),
              r = node.radius + quad.point.radius;
          if (l < r) {
            l = (l - r) / l * .5;
            node.x -= x *= l;
            node.y -= y *= l;
            quad.point.x += x;
            quad.point.y += y;
          }
        }
        return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
      };
    } // ---- END collide -------------- //
    

    // ------ function neighboring ----- //
    function neighboring(a, b) {
      return linkedByIndex[a.index + "," + b.index];
    } // ---- END neighboring ---------- //
  </script>
</body>
<script>
  // JavaScript kullanarak tarihi al ve div içine yaz
  const currentDateElement = document.getElementById('currentDate');

  // Şu anki tarihi al
  const currentDate = new Date();
  
  // Tarih formatını ayarla (Örnek: "January 14, 2023")
  const options = { month: 'long', day: 'numeric', year: 'numeric' };
  const formattedDate = currentDate.toLocaleDateString('tr-Tr', options);

  // HTML içeriğini güncel tarihle doldur
  currentDateElement.textContent = formattedDate;
</script>